
	<!--Handlebars.js template for modules-->
	<script id="moduleTemplate" type="text/x-handlebars-template">
		<div class="module {{moduleCssClass}} ">
			<span class="dataContainer"></span>

			<header class="{{headerCssClass}}">
				<div style="margin: 0 0 5px 0;">{{moduleName}}</div>
			</header>
			
			{{#if hasKeyboardInterface}}
				<fieldset>
					<div id="keyboard"></div>
					<div>&nbsp;</div>
					<div id="keyboardNoteInput">&nbsp;</div>
				</fieldset>
			{{/if}}

			{{#if hasStartButton}}
				<fieldset>
					<button class="{{buttonCssClass}}">Start</button>
				</fieldset>
			{{/if}}

			{{#each sections}}

			<fieldset {{#if ../renderSectionsVertically}}class="verticalAligned"{{/if}}>

				{{#if sectionName}}
					<legend>{{sectionName}}</legend>
				{{/if}}

				{{#each buttons}}
				<button name="{{buttonId}}">{{buttonName}}</button>
				{{/each}}
				
				{{#each leds}}
					<led-atom color="{{color}}" blinkrate="{{blinkrate}}" label="{{label}}"></led-atom>
				{{/each}}
				
				{{#each checkBoxes}}
				<div>
					<span title="{{type}}" class="parameterLabel ">{{label}}: </span> <input type="checkbox" data-parametertype="{{type}}" />
				</div>
				{{/each}}

				{{#each radioButtonLists}}
				<div>
					<span title="{{type}}" class="parameterLabel ">{{label}}: </span>
					{{#each radioButtons}}
						<div class="radioButtonWrapper">
							<input 	type="radio" 
									name="{{../rdoName}}" 
									id="{{../rdoName}}_{{value}}"
									value="{{value}}" 
									title="{{value}}" 
									data-parametertype="{{../type}}" 
									{{#if selected}}checked{{/if}}
									class="pushbutton">
							</input>
							<label for="{{../rdoName}}_{{value}}" class="moduleRadioLabel"><span></span>
								{{#if img}}
									<img src="{{img}}" alt="{{name}}" title="{{name}}" />
								{{else}}
									{{{name}}}
								{{/if}}
							</label>
						</div>
					{{/each}}
				</div>
				{{/each}}

				{{#each selectLists}}
				<div>
					<span title="{{type}}" class="parameterLabel ">{{label}}: </span>
					<select data-parametertype="{{type}}">
					{{#each options}}
						<option value="{{value}}" 
							{{#if selected}}selected{{/if}} >
							{{name}}
						</option>
					{{/each}}
					</select>
				</div>
				{{/each}}
				
				<!--TODO
				<webaudio-switch id="switch-1" src="/_thirdparty/webaudio-controls/img/switch_toggle.png" width="32" height="32"></webaudio-switch>
				<webaudio-keyboard keys="25" ></webaudio-keyboard>-->

				{{#each ranges}}
				<div class="{{../rangeDisplayMode}}">
					<span title="{{type}}" class="parameterLabel {{../rangeDisplayMode}}">{{label}} </span>
						
					{{#ifCond ../rangeDisplayMode "webaudio-controls-vslider"}}
						<webaudio-slider name="{{name}}"
							id="{{name}}"
							data-parameterType="{{type}}" 
							src="/img/custom-webaudio-controls/custom-vslider-track.png" 
							knobsrc="/img/custom-webaudio-controls/custom-vslider-knob.png" 
							width="24" height="115" valuetip="0" 
							min="{{min}}" 
							max="{{max}}" 
							value="{{value}}" 
							step="{{step}}" ></webaudio-slider>
						<!--<webaudio-param link="{{name}}"></webaudio-param> this binding wont work because the HBS template has not been rendered to the DOM yet-->
						<output for="{{name}}" class="{{../rangeDisplayMode}}">{{value}}</output>
					{{else}}
					
					{{#ifCond ../rangeDisplayMode "webaudio-controls-blue-knob"}}
						<webaudio-knob name="{{name}}"
							id="{{name}}"
							data-parameterType="{{type}}" 
							src="/img/webknobman-webaudio-controls/blue-knob.png" 
							sprites="100" diameter="64" valuetip="0" 
							min="{{min}}" 
							max="{{max}}" 
							value="{{value}}" 
							step="{{step}}" ></webaudio-knob>
						<!--<webaudio-param link="{{name}}"></webaudio-param> this binding wont work because the HBS template has not been rendered to the DOM yet-->
						<output for="{{name}}" class="{{../rangeDisplayMode}}">{{value}}</output>
					{{else}}
					
					{{#ifCond ../rangeDisplayMode "webaudio-controls-color_knob"}}
						<webaudio-knob name="{{name}}"
							id="{{name}}"
							data-parameterType="{{type}}" 
							src="/img/webknobman-webaudio-controls/color_knob.png" 
							sprites="29" width="46" height="46" valuetip="0" 
							min="{{min}}" 
							max="{{max}}" 
							value="{{value}}" 
							step="{{step}}" ></webaudio-knob>
						<!--<webaudio-param link="{{name}}"></webaudio-param> this binding wont work because the HBS template has not been rendered to the DOM yet-->
						<output for="{{name}}" class="{{../rangeDisplayMode}}">{{value}}</output>
					{{else}}
				
					<input 	type="range" 
							data-parametertype="{{type}}" 
							min="{{min}}" 
							max="{{max}}" 
							value="{{value}}" 
							step="{{step}}" 
							name="{{name}}"
							title="{{value}}"

							list="{{name}}_datalist" 

							class="{{../rangeDisplayMode}}"							 />

							<!--TODO remove slider-vertical. use webaudio-controls instead-->
					{{#ifCond ../rangeDisplayMode "slider-vertical"}}
						{{!--tick marks--}}
						<datalist id="{{name}}_datalist">
							<option>{{min}}</option>
							<option>{{#percentage min max 10}}{{/percentage}}</option>
							<option>{{#percentage min max 20}}{{/percentage}}</option>
							<option>{{#percentage min max 30}}{{/percentage}}</option>
							<option>{{#percentage min max 40}}{{/percentage}}</option>
							<option>{{#percentage min max 50}}{{/percentage}}</option>
							<option>{{#percentage min max 60}}{{/percentage}}</option>
							<option>{{#percentage min max 70}}{{/percentage}}</option>
							<option>{{#percentage min max 80}}{{/percentage}}</option>
							<option>{{#percentage min max 90}}{{/percentage}}</option>
							<option>{{max}}</option>
						</datalist>

						{{!--A second range input, for styling purposes only
							since the datalist renders ticks on one side of the range input only,
							this second range input is used to get tick marks on the other side--}}
						<input 	type="range" 
								name="{{name}}_shadowrange"
								min="{{min}}" 
								max="{{max}}" 
								value="{{value}}" 
								step="{{step}}" 

								list="{{name}}_datalist" 

								class="{{../../rangeDisplayMode}} shadowrange"							 />
					{{/ifCond}}
					
					<output for="{{name}}" class="{{../rangeDisplayMode}}">{{value}}</output>

					{{/ifCond}}
					{{/ifCond}}
					{{/ifCond}}
				</div>
				{{/each}}

			</fieldset>

			{{/each}}

			{{#if hiddenParameters}}
			<fieldset>
			{{#each hiddenParameters}}
			<div>
				<input	type="hidden"
						data-parametertype="{{type}}"
						name="{{name}}"
						value="{{value}}" />
			</div>
			{{/each}}
			</fieldset>
			{{/if}}

			<fieldset class="connectors">
				<legend>Connectors</legend>
				{{#if hasTriggerIn}}
					<div><div>Trigger<br/>In</div><div><span class="patchHole " data-patch-type="triggerIn">&nbsp;</span></div></div>
				{{/if}}

				{{#if hasTriggerOut}}
					<div><div>Trigger<br/>Out</div><div><span class="patchHole " data-patch-type="triggerOut">&nbsp;</span></div></div>
				{{/if}}

				{{#if hasControlIn}}
					<div><div>Control<br/>In</div><div><span class="patchHole " data-patch-type="controlIn">&nbsp;</span></div></div>
				{{/if}}

				{{#if hasControlOut}}
					<div><div>Control<br/>Out</div><div><span class="patchHole " data-patch-type="controlOut">&nbsp;</span></div></div>
				{{/if}}

				{{#if hasAudioIn}}
					<div><div>Audio<br/>In</div><div><span class="patchHole " data-patch-type="audioIn">&nbsp;</span></div></div>
				{{/if}}

				{{#if hasAudioOut}}
					<div><div>Audio<br/>Out</div><div><span class="patchHole " data-patch-type="audioOut">&nbsp;</span></div></div>
				{{/if}}
			</fieldset>
		</div>
	</script>

<script>
	// importDoc references this import's document
	var importDoc = document.currentScript.ownerDocument;

	// mainDoc references the main document (the page that's importing us)
	var mainDoc = document;

	// Grab the element from this import, clone it,
	// and append it to the importing document.
	var el = importDoc.querySelector('#moduleTemplate');
	mainDoc.body.appendChild(el.cloneNode(true));
</script>
